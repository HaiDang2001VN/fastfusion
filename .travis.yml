os: linux

language: python

python: "3.6"

dist: bionic

sudo: require

addons:
  apt:
    update: true
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - gcc-7
      - g++-7
      - libboost-all-dev
      - libeigen3-dev
      - libglew-dev
      - libglfw-dev
      - freeglut3-dev
      - qt4-dev-tools
      - libopencv-dev
before_install:
  - sudo ln -s /usr/bin/gcc-7 /usr/local/bin/gcc
  - sudo ln -s /usr/bin/g++-7 /usr/local/bin/g++
  - export CC=/usr/bin/gcc-7
  - export CXX=/usr/bin/g++-7
  - wget http://www.libqglviewer.com/src/libQGLViewer-2.6.3.tar.gz
  - tar -xvzf libQGLViewer-2.6.3.tar.gz
  - cd libQGLViewer-2.6.3

install:
  - make
  - sudo make install

before_script:
  - sudo ln -s /usr/lib/x86_64-linux-gnu/libQGLViewer-qt4.so.2.6.3 /usr/lib/libQGLViewer.so
  - sudo ln -s /usr/lib/x86_64-linux-gnu/libQGLViewer-qt4.so.2.6.3 /usr/lib/libQGLViewer-qt4.so
  - sudo ln -s /usr/lib/x86_64-linux-gnu/libQGLViewer-qt4.so.2.6.3 /usr/lib/libqglviewer-qt4.so
  - cd ..

script:
  - cmake .
  - make

after_success:
  - cp ${ROOT}/usr/lib/x86_64-linux-gnu/libQGLViewer.so $PWD/lib
  - zip -r -9 Release bin lib src

before_deploy:
  - git config --local user.name HaiDang2001VN
  - git config --local user.email danghailamhuynh@gmail.com
  - git tag "$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)"

deploy:
  provider: releases
  api_key:
      secure: "Kco6ZHjEiO0OQp+4XZO+dcHX0n4uNihe2/TATl8MLRerbYNbgcteExWir3REtR3TOA0K228QzbApNw0azY8mEgcus0YWEGnOZctDOAtb5KWlSdCbVTcRAKiwfcR8SYE37aEaLNiap/ktSFf1v42qyvuLA6vAdxLzitOZZWKjijp3TcAahWB8v55f9luivbqA0zzSXTdr+nohKuuwHfCtqOvdyHlZeR29A3etQb2Q5iA/ouqucDSFdvB1W9qIlaXwb8O4jVji46370GMkTeVJpaqyomfpfsvy+iHBX+OnTzVKDEseD5Td87gWeVgUTMAq090CcG6DOQXi6Bs/KIMNgnKQBDFUHeHEudpDWETkN3oauXQ+s4m+PxQwZrkZHbmyBiuBko0n8ORsveAqRUa3bn9dkD1l9vYME4P5H16MUt3LojIHb0gXV4V0ScmmD+Ok4lEpwDlex8XbG6wgFR7gRul168GqHhn162RO6/UgMStCdYpTk391MkmUIXVjn+v12fjFEotRzpwDM5k/p/VADW3gCTGzb0r0C4Nld8zezhwguvErSpbolR44lLoqF+K5cCz2yY/KqF55aNecyLQ6ENn95FdGhbGYpfOt2kn7UTscPwQRG40LKnB4Ta4XG+UvDOQ8HltliibQzB9GyK8fThdO1qI8pbJht1hDE4m3o/M="
  file_glob: true
  file: "Release.zip"
  skip_cleanup: true
  overwrite: true
  on:
      repo: HaiDang2001VN/fastfusion
      all_branches: true
      tags: true
